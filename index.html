<!DOCTYPE html>
<html ng-app="healthcareApp">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Reasonable Care - the Tool</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/1-col-portfolio.css" rel="stylesheet">

    <!-- my own css -->
    <link href="css/style.css" rel="stylesheet">

    <!-- slider styling -->
    <link href="slider/css/slider.css" rel="stylesheet">

    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Reasonable Care</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">                <ul class="nav navbar-nav">
                    <li>
                        <a href="#">Use the Tool</a>
                    </li>
                    <li>
                        <a href="#">Methodology</a>
                    </li>
                    <li>
                        <a href="#">Team</a>
                    </li>

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container">
        <div class="row" ng-controller="plansController">

            <div class="col-md-5">
                <h1 class="page-header">Preferences
                    <small>Filter by what you care about</small>
                </h1>
                <div class="pref-tile">
                    <div class="pref-tile-header">
                        <h2>
                            <button class="btn exp-button primary-button" type="button" style="float:right">
                                <i class="fa fa-angle-double-down"></i>
                            </button>
                            Deductible vs. Premium
                        </h2>
                    </div>
                    <div class="expandable">

                        <h3 style="text-align:center; margin:0px;padding-bottom:10px">
                                Turn on or off: &nbsp;&nbsp;
                                <input class="sl1" value="1"  style="width: 50px;"  data-slider-min="0"
                                data-slider-max="1" id="deduct-tog"/>
                            </h3>
                    </div>
                    <div class="pref-tile-body">
                        <hr>
                            <h3 style="text-align:center; margin:0px;">
                                <input class="slDeduct" value="2" style="width: 100%;" data-slider-min="0" id="deduct-val" data-slider-max="4"/> <br/>
                            </h3>
                    </div>
                </div>

                <div class="pref-tile">
                    <div class="pref-tile-header">
                        <h2>Covered Drugs
                        <button class="btn exp-button primary-button" type="button" style="float:right">
                                <i class="fa fa-angle-double-down"></i>
                            </button>
                        </h2>
                    </div>
                    <div class="expandable">
                        <h3 style="text-align:center; margin:0px;padding-bottom:10px">
                            Turn on or off: &nbsp;&nbsp;
                            <input class="sl1" value="1" style="width: 50px;"  data-slider-min="0"
                            data-slider-max="1" data-slider-val="0"/>
                        </h3>
                    </div>
                    <div class="pref-tile-body">
                        <hr>
                        <h3 style="text-align:center; margin:0px;">
                            <input type="text"style="width: 100%;" placeholder="Enter drugs you'd like covered"> <br/>
                        </h3>
                        <h4>Note: Feature currently unavailable!</h4>
                    </div>
                </div>

                <div class="pref-tile">
                    <div class="pref-tile-header">
                        <h2>
                            <button class="btn exp-button" type="button" style="float:right">
                                <i class="fa fa-angle-double-down"></i>
                            </button>
                            Primary Care
                        </h2>
                        <!-- <h4 style="float:right">filler</h4> -->

                    </div>
                    <div class="expandable">
                        <h3 style="text-align:center; margin:0px;padding-bottom:10px">
                            Turn on or off: &nbsp;&nbsp;
                            <input class="sl1" value="1" style="width: 50px;"  data-slider-min="0"
                            data-slider-max="1" id="prim-care-tog"/>
                        </h3>
                    </div>
                    <div class="pref-tile-body">
                        <hr>
                        <h3>In Network</h3>
                        <div class="panel panel-default">
                            <div class="btn-group btn-input clearfix">
                                <button type="button" class="btn btn-default dropdown-toggle form-control" data-toggle="dropdown">
                                    <span data-bind="label" id="prim-care-in">Select One</span>&nbsp;<span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">No co-payment please!</a></li>
                                    <li><a href="#">Only co-payments after deductible</a></li>
                                    <li><a href="#">Only co-payments before deductible</a></li>
                                    <li><a href="#">Not important to me!</a></li>
                                </ul>
                            </div>
                        </div>

                        <h3>Out of Network</h3>
                        <div class="panel panel-default">
                            <div class="btn-group btn-input clearfix">
                                <button type="button" class="btn btn-default dropdown-toggle form-control" data-toggle="dropdown">
                                    <span data-bind="label" id="prim-care-out">Select One</span>&nbsp;<span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">No co-payment please!</a></li>
                                    <li><a href="#">Only co-payments after deductible</a></li>
                                    <li><a href="#">Only co-payments before deductible</a></li>
                                    <li><a href="#">I just want out of network as an option</a></li>
                                    <li><a href="#">Not important to me!</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pref-tile">
                    <div class="pref-tile-header">
                        <h2>
                        Specialist
                        <button class="btn exp-button" type="button" style="float:right">
                            <i class="fa fa-angle-double-down"></i>
                        </button>
                        </h2>
                    </div>
                    <div class="expandable">
                        <h3 style="text-align:center; margin:0px;padding-bottom:10px">
                            Turn on or off: &nbsp;&nbsp;
                            <input class="sl1" value="1" style="width: 50px;" data-slider-min="0"
                            data-slider-max="1" id="spec-tog"/>
                        </h3>
                    </div>
                    <div class="pref-tile-body">
                        <hr>
                        <h3>In Network</h3>
                        <div class="panel panel-default">
                            <div class="btn-group btn-input clearfix">
                                <button type="button" class="btn btn-default dropdown-toggle form-control" data-toggle="dropdown">
                                    <span data-bind="label" id="spec-in">Select One</span>&nbsp;<span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">No co-payment please!</a></li>
                                    <li><a href="#">Only co-payments after deductible</a></li>
                                    <li><a href="#">Only co-payments before deductible</a></li>
                                    <li><a href="#">Not important to me!</a></li>
                                </ul>
                            </div>
                        </div>

                        <h3>Out of Network</h3>
                        <div class="panel panel-default">
                            <div class="btn-group btn-input clearfix">
                                <button type="button" class="btn btn-default dropdown-toggle form-control" data-toggle="dropdown">
                                    <span data-bind="label" id="spec-out">Select One</span>&nbsp;<span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">No co-payment please!</a></li>
                                    <li><a href="#">Only co-payments after deductible</a></li>
                                    <li><a href="#">Only co-payments before deductible</a></li>
                                    <li><a href="#">I just want out of network as an option</a></li>
                                    <li><a href="#">Not important to me!</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="pref-tile">
                    <div class="pref-tile-header">
                        <h2>Emergency Room
                            <button class="btn exp-button" type="button" style="float:right">
                                <i class="fa fa-angle-double-down"></i>
                            </button></h2>
                    </div>
                    <div class="expandable">
                        <h3 style="text-align:center; margin:0px;padding-bottom:10px">
                            Turn on or off: &nbsp;&nbsp;
                            <input class="sl1" value="1" style="width: 50px;" id="er-tog" data-slider-min="0"
                            data-slider-max="1"/>
                        </h3>
                    </div>
                    <div class="pref-tile-body">
                        <hr>
                        <h3>In Network</h3>
                        <div class="panel panel-default">
                            <div class="btn-group btn-input clearfix">
                                <button type="button" class="btn btn-default dropdown-toggle form-control" data-toggle="dropdown">
                                    <span data-bind="label" id="er-in">Select One</span>&nbsp;<span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">No co-payment please!</a></li>
                                    <li><a href="#">Only co-payments after deductible</a></li>
                                    <li><a href="#">Only co-payments before deductible</a></li>
                                    <li><a href="#">Not important to me!</a></li>
                                </ul>
                            </div>
                        </div>

                        <h3>Out of Network</h3>
                        <div class="panel panel-default">
                            <div class="btn-group btn-input clearfix">
                                <button type="button" class="btn btn-default dropdown-toggle form-control" data-toggle="dropdown">
                                    <span data-bind="label" id="er-out">Select One</span>&nbsp;<span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li><a href="#">No co-payment please!</a></li>
                                    <li><a href="#">Only co-payments after deductible</a></li>
                                    <li><a href="#">Only co-payments before deductible</a></li>
                                    <li><a href="#">I just want out of network as an option</a></li>
                                    <li><a href="#">Not important to me!</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <br/>
                <button type="button" class="btn btn-primary btn-lg" style="margin: 0 auto; display:block" id="find-plan" ng-click="update(userPrefs)">
                    Find Plan
                </button>
            </div>

            <div class="col-md-7" >
                <h1 class="page-header">Results
                    <small>Healthcare plans relevant to your preferences</small>
                </h1>
                <!-- <div class="plan-tile" ng-repeat="plan in plans"> -->
                <div class="plan-tile">
                    <div class="plan-tile-header">
                        <h2>
                        <button class="btn exp-button primary-button" type="button" style="float:left">
                            <i class="fa fa-angle-double-down"></i>
                        </button> &nbsp;&nbsp;{{ plans.name }}
                        </h2>
                    </div>
                    <div class="expandable" >
                        <h3>
                            Deduct vs. Prem: <span ng-bind-html="plans.deductStars | unsafe"></span>
                        </h3>
                        <hr class="separator-tight" />

                        <h3>
                            Primary Care: <span ng-bind-html="plans.primStars | unsafe"></span>
                        </h3>
                        <hr class="separator-tight" />

                        <h3>
                            Specialist: <span ng-bind-html="plans.specStars | unsafe"></span>
                        </h3>
                        <hr class="separator-tight" />

                        <h3>
                            Emergency Care: <span ng-bind-html="plans.erStars | unsafe"></span>
                        </h3>
                        <hr class="separator-tight" />
                    </div>
                    <div class="plan-tile-body">
                        <table id="plan-table" style="display:block; margin:0 auto;">
                            <col class="c1" />
                            <col class="c2" />
                            <tr>
                                <td>Annual Deductible: </td>
                                <td>{{ plans.deductRaw }}</td>
                            </tr>
                            <tr>
                                <td>Monthly Premium: </td>
                                <td>{{ plans.premRaw }}</td>
                            </tr>
                            <tr>
                                <td>Co-payment for Primary Care, in network: </td>
                                <td>{{ plans.primInRaw }}</td>
                            </tr>
                            <tr>
                                <td>Co-payment for Primary Care, out of network: </td>
                                <td>{{ plans.primOutRaw }}</td>
                            </tr>
                            <tr>
                                <td>Co-payment for Specialist, in network: </td>
                                <td>{{ plans.specInRaw }}</td>
                            </tr>
                            <tr>
                                <td>Co-payment for Specialist, out of network: </td>
                                <td>{{ plans.specOutRaw }}</td>
                            </tr>
                            <tr>
                                <td>Co-payment for Emegency Room, in network: </td>
                                <td>{{ plans.erInRaw }}</td>
                            </tr>
                            <tr>
                                <td>Co-payment for Emergency Room, out of network:</td>
                                <td>{{ plans.erOutRaw }}</td>
                            </tr>
                        </table>
                    </div>
                    <!-- <img class="img-responsive" src="http://placehold.it/700x300" alt=""> -->
                </div>
            </div>
        </div>
    </div>

    </div>
    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- angularejs includes -->
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.3/angular-route.js"></script>

    <!-- JS for slider -->
    <script src="slider/js/bootstrap-slider.js"></script>
    <script>


        //Angular stuff

        var app = angular.module('healthcareApp', ['ngRoute']);


        app.filter('unsafe', function($sce) {
            return function(val) {
                return $sce.trustAsHtml(val);
            };
        });



        app.controller('plansController', function($scope, plansFactory){
            // $scope.plans = [
            //     {"id": 1, "name": "plan1 has a very long name which goes over"},
            //     {"id": 2, "name": "plan2 yi"}
            // ];
            var userInput = new Object();
            plansFactory.getPlans().success(function(data){
                    console.log(data);
                    $scope.plans = plansView(data, userInput);
                    console.log($scope.plans);
                    //$scope.plans = data;
                });
            function init() {
                plansFactory.getPlans().success(function(data){
                    console.log("reached here");
                    console.log(data);
                    $scope.plans = data;
                });
            }
        });

        app.factory('plansFactory', function($http){
            var factory = {};
            factory.getPlans = function(){
                return $http.get('https://healthexchangeapi.herokuapp.com/plan/7144');
                //return $http.get('https://healthexchangeapi.herokuapp.com/search/MA/1');
            }
            return factory
        })

        //function which compares user input and plan data and creates the plansFinal
        //object which is used to render the view
        function plansView(plansData, userInput){
            console.log("in plansView function");
            console.log(plansData.id);
            var plansFinal = new Object();
            plansFinal.name = plansData.Plan_Marketing_Name;
            plansFinal.premRaw = plansData.Premium_Adult_Individual_Age_27;
            plansFinal.deductRaw = plansData.Medical_Deductible_individual_in_network;
            var premStarsNum = calcPremStars(plansFinal.premRaw,
                                             plansFinal.deductRaw,
                                             userInput);
            plansFinal.deductStars = createStars(premStarsNum);

            plansFinal.primInRaw = plansData.Primary_Care_Physician_in_network;
            plansFinal.primOutRaw = plansData.Primary_Care_Physician_out_of_network;
            var primStarsNum = calcPrimStars(plansFinal.primInRaw,
                                             plansFinal.primOutRaw,
                                             userInput);
            plansFinal.primStars = createStars(primStarsNum);

            plansFinal.specInRaw = plansData.Specialist_in_network;
            plansFinal.specOutRaw = plansData.Specialist_out_of_network;
            var specStarsNum = calcSpecStars(plansFinal.specInRaw,
                                             plansFinal.specOutRaw,
                                             userInput);
            plansFinal.specStars = createStars(specStarsNum);

            plansFinal.erInRaw = plansData.Emergency_Room_in_network;
            plansFinal.erOutRaw = plansData.Emergency_Room_out_of_network;
            var erStarsNum = calcPremStars(plansFinal.erInRaw,
                                             plansFinal.erOutRaw,
                                             userInput);
            plansFinal.erStars = createStars(erStarsNum);

            console.log(JSON.stringify(plansFinal));
            return plansFinal;
        }


        // utilitiy function which checks if passed in value exists. If it does,
        // value is returned, otherwise -1 is returned

        function valExists(n){
            return (n == "") ? -1 : n;
        }

        // function which takes a number of stars and outputs the html for that
        // many stars
        function createStars(numStars){
            var outputString = "";
            var star = "<span style='float:right'class=' glyphicon glyphicon-star' aria-hidden='true'></span>";
            var starEmpty = "<span style='float:right'class=' glyphicon glyphicon-star-empty' aria-hidden='true'></span>";

            for(var i = 0; i < 4 - numStars; i++){
                outputString += starEmpty;
            }
            for(var i = 0; i < numStars; i++){
                outputString += star;
            }
            return outputString;
        }

/*********************** Calculate num stars functions ***********************/

        function calcPremStars(premRaw, deductRaw, userInput){
            return 1;
        }
        function calcPrimStars(primInRaw, primOutRaw, userInput){
            return 1;
        }
        function calcSpecStars(specInRaw, specOutRaw, userInput){
            return 1;
        }
        function calcErStars(erInRaw, erOutRaw, userInput){
            return 1;
        }

        $("input.slider3").slider();
        $('input.sl1').slider({
            formater: function(value) {
                if(value == 0){
                    return "OFF"
                } else {
                    return "ON"
                }
            }
        });


        $('input.slDeduct').slider({
            formater: function(value) {
                if(value == 0)
                    return "Cheapest Deductible"
                if(value == 1)
                    return "Cheaper Deductible"
                if(value == 2)
                    return "Even"
                if(value == 3)
                    return "Cheaper Premium"
                else
                    return "Cheapest Premium"
            }
        });

        $('input.slPrimIn').slider({
            formater: function(value) {
                if(value == 0)
                    return "No co-payments please!"
                if(value == 1)
                    return "Only Copayments after deductible"
                if(value == 2)
                    return "Only Copayment before deductible"
                else
                    return "Not important to me!"
            }
        })

        $( document.body ).on( 'click', '.dropdown-menu li', function( event ) {
          var $target = $( event.currentTarget );
          $target.closest( '.btn-group' )
             .find( '[data-bind="label"]' ).text( $target.text() )
                .end()
             .children( '.dropdown-toggle' ).dropdown( 'toggle' );
          return false;
        });

        //event - user clicks on the "find plan" button, user input is processed
        //        and the api is called
        $('#find-plan').click(function(){
            var uInput = new Object();
            if($('#deduct-tog').val() == 1)
                uInput.deductVal = $('#deduct-val').val();
            else
                uInput.deductVal = -1;

            if($('#prim-care-tog').val() == 1){
                uInput.primCareIn = valExists($('#prim-care-in').val());
                uInput.primCareOut = valExists($('#prim-care-out').val());
            }
            else {
                uInput.primCareIn = -1;
                uInput.primCareOut = -1;
            }
            if($('#spec-tog').val() == 1){
                uInput.specIn = valExists($('#spec-in').val());
                uInput.specOut = valExists($('#spec-out').val());
            }
            else{
                uInput.specIn = -1;
                uInput.specOut = -1;
            }
            if($('#er-tog').val() == 1){
                uInput.erIn = valExists($('#er-in').val());
                uInput.erOut = valExists($('#er-out').val());
            }
            else{
                uInput.erIn = -1;
                uInput.erOut = -1;
            }
            console.log(uInput);
        });




        $(function(){

            // $('input.sl1').slider('setValue', 1);
            $('input.slDeduct').slider('setValue', 2);
            $('.pref-tile-body').hide();
            $('.plan-tile-body').hide();
            $('.exp-button').on('click', function(){

                var expandText = "<i class='fa fa-angle-double-down'></i>";
                var collapseText = "<i class='fa fa-angle-double-up'></i>";

                $(this).closest('div').siblings(".pref-tile-body").toggle();
                $(this).closest('div').siblings(".plan-tile-body").toggle();

                if($(this).html().search('down') != -1) {
                    $(this).html(collapseText);
                } else {
                    $(this).html(expandText);
                }
            });

            window.prettyPrint && prettyPrint();
            $('.switch').slider({
                formater: function(value) {
                    if(value == 0){
                        return "OFF"
                    } else {
                        return "ON"
                    }
                }
            });

            $('input.sl1').slider().on('slideStop', function(ev){
                var alpha = 0.15
                var elem = $(this).parent().parent().parent().parent();
                if($(this).val() == 0){
                    console.log('turned on the toggle');
                    alpha = .6;

                    elem.css('background-color', 'rgba(0,0,0,' + alpha + ')');
                } else {
                    elem.css('background-color', 'rgba(255,20,20,' + alpha + ')');
                }
            });

        });
    </script>
</body>

</html>
